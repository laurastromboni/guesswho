var people = [
  { name: 'abi',
    img: 'Avatar_Abi.png',
    genre: 'genre-female',
    hairColor: 'hair-brown',
    haircut: 'haircut-middle',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Abi.png' },
  { name: 'adele',
    img: 'Avatar_Adele.png',
    genre: 'genre-female',
    hairColor: 'hair-ginger',
    haircut: 'haircut-long',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Adele.png' },
  { name: 'amine',
    img: 'Avatar_Amine.png',
    genre: 'genre-male',
    hairColor: 'hair-black',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-metis',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Amine.png' },
  { name: 'antoine',
    img: 'Avatar_Antoine.png',
    genre: 'genre-male',
    hairColor: 'hair-black',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-yes',
    skin: 'skin-white',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Antoine.png' },
  { name: 'cecile',
    img: 'Avatar_Cecile.png',
    genre: 'genre-female',
    hairColor: 'hair-brown',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Cecile.png' },
  { name: 'chloe',
    img: 'Avatar_Chloe.png',
    genre: 'genre-female',
    hairColor: 'hair-brown',
    haircut: 'haircut-middle',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Chloe.png' },
  { name: 'christian',
    img: 'Avatar_Christian.png',
    genre: 'genre-male',
    hairColor: 'hair-brown',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-black',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Christian.png' },
  { name: 'corrado',
    img: 'Avatar_Corrado.png',
    genre: 'genre-male',
    hairColor: 'hair-brown',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Corrado.png' },
  { name: 'fareaha',
    img: 'Avatar_Fareaha.png',
    genre: 'genre-female',
    hairColor: 'hair-black',
    haircut: 'haircut-middle',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-metis',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Fareaha.png' },
  { name: 'filippo',
    img: 'Avatar_Filippo.png',
    genre: 'genre-male',
    hairColor: 'hair-black',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-yes',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Filippo.png' },
  { name: 'geoffroy',
    img: 'Avatar_Geoffroy.png',
    genre: 'genre-male',
    hairColor: 'hair-brown',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-yes',
    skin: 'skin-metis',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Geoffroy.png' },
  { name: 'harnit',
    img: 'Avatar_Harnit.png',
    genre: 'genre-female',
    hairColor: 'hair-black',
    haircut: 'haircut-long',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-metis',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Harnit.png' },
  { name: 'heather',
    img: 'Avatar_Heather.png',
    genre: 'genre-female',
    hairColor: 'hair-black',
    haircut: 'haircut-long',
    eyesColor: 'eyes-green',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Heather.png' },
  { name: 'helen',
    img: 'Avatar_Helen.png',
    genre: 'genre-female',
    hairColor: 'hair-brown',
    haircut: 'haircut-middle',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-black',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Helen.png' },
  { name: 'jean ni',
    img: 'Avatar_Jean-Ni.png',
    genre: 'genre-male',
    hairColor: 'hair-blond',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Jean-Ni.png' },
  { name: 'laura',
    img: 'Avatar_Laura.png',
    genre: 'genre-female',
    hairColor: 'hair-brown',
    haircut: 'haircut-long',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Laura.png' },
  { name: 'marie',
    img: 'Avatar_Marie.png',
    genre: 'genre-female',
    hairColor: 'hair-blond',
    haircut: 'haircut-middle',
    eyesColor: 'eyes-blue',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Marie.png' },
  { name: 'mathis',
    img: 'Avatar_Mathis.png',
    genre: 'genre-male',
    hairColor: 'hair-blond',
    haircut: 'haircut-short',
    eyesColor: 'eyes-green',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Mathis.png' },
  { name: 'mehdi',
    img: 'Avatar_Mehdi.png',
    genre: 'genre-male',
    hairColor: 'hair-black',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-yes',
    skin: 'skin-metis',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Mehdi.png' },
  { name: 'niccolo',
    img: 'Avatar_Niccolo.png',
    genre: 'genre-male',
    hairColor: 'hair-brown',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Niccolo.png' },
  { name: 'nicolas',
    img: 'Avatar_Nicolas.png',
    genre: 'genre-male',
    hairColor: 'hair-brown',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Nicolas.png' },
  { name: 'nizar',
    img: 'Avatar_Nizar.png',
    genre: 'genre-male',
    hairColor: 'hair-brown',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-yes',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Nizar.png' },
  { name: 'paul',
    img: 'Avatar_Paul.png',
    genre: 'genre-male',
    hairColor: 'hair-black',
    haircut: 'haircut-short',
    eyesColor: 'eyes-blue',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Paul.png' },
  { name: 'priyanka',
    img: 'Avatar_Priyanka.png',
    genre: 'genre-female',
    hairColor: 'hair-black',
    haircut: 'haircut-middle',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-metis',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Priyanka.png' },
  { name: 'regis',
    img: 'Avatar_Regis.png',
    genre: 'genre-male',
    hairColor: 'hair-brown',
    haircut: 'haircut-short',
    eyesColor: 'eyes-blue',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Regis.png' }
];

$(document).ready(function(){
  var guessWho = new GuessWho(people);

  // use the shuffle function to shuffle randomnly the cards
  guessWho.shuffleCards();

  // show the popup welcome at the begining of the game, when we refresh the page
  var startgame = $('.popup-welcome');
  startgame.css({"display" : "block"});
  $(".game").addClass("blocked");

  // Array of every people
  console.log(guessWho.people);
  // create the HTML divs for each people
  var html = '';
  guessWho.people.forEach(function (people) {
    html += '<div class="people ' + people.genre + ' ' + people.hairColor + ' '  + people.haircut + ' '  + people.eyesColor + ' '  + people.facialHair + ' '  + people.skin + ' '  + people.glasses + ' '  + people.frenchNative + ' " data-people-name="'+ people.name +'">';
    html += '  <div class="front-people" style="background: url(img/'+ people.img + '); background-size: contain;background-position: center;background-repeat: no-repeat"></div>';
    html += '  <div class="back-people"  style="background-color: #F8F5F5" name="'+ people.img +'"></div>';
    html += '</div>';
  });
  // Add all the div's to the HTML
  $('#avatars-board').html(html);

  var guessWhoPeople = people[Math.floor(Math.random()*people.length)];
  console.log(guessWhoPeople);

    // create the HTML img divs for each people
    var htmlTwo = $(
      '<div class="popup-img-new" style="background: url(img/'+ guessWhoPeople.nudeImg + '); background-size: contain;background-position: center;background-repeat: no-repeat"></div>'
    );
    // Add all the div's to the HTML
    $('.popnew h2').after(htmlTwo);

  // main feature : hide the wrong people after clicking on caracteristics buttons
  var buttons = $(".caracteristic");
  var guessWho = new GuessWho(people);
  buttons.click(function (e){
    var currentbutton = $(event.target);
    guessWho.updateChances()
    // console.log(e.currentTarget);

    // add a new class to the characteristic (<img>) clicked
    currentbutton.addClass("caracteristic-clicked");
    // genre :
    var genreNotClickedYet = $(".genre").not(".caracteristic-clicked"); // returns the genre which is not clicked yet
    if (genreNotClickedYet.length === 1){
      genreNotClickedYet.addClass("caracteristic-clicked");
    }
    //eyes color :
    var eyesColorNotClickedYet = $(".eyesColor").not(".caracteristic-clicked"); 
    if (eyesColorNotClickedYet.length === 1) {
      eyesColorNotClickedYet.addClass("caracteristic-clicked");
    }
    //skin :
    var skinNotClickedYet = $(".skin").not(".caracteristic-clicked");
    if (skinNotClickedYet.length === 1) {
      skinNotClickedYet.addClass("caracteristic-clicked");
    }
    // glasses :
    var glassesNotClickedYet = $(".glasses").not(".caracteristic-clicked");
    if (glassesNotClickedYet.length === 1){
      glassesNotClickedYet.addClass("caracteristic-clicked");
    }
    // facial hair :
    var facialHairNotClickedYet = $(".facialHair").not(".caracteristic-clicked");
    if (facialHairNotClickedYet.length === 1){
      facialHairNotClickedYet.addClass("caracteristic-clicked");
    }
    // hair cut :
    var haircutNotClickedYet = $(".haircut").not(".caracteristic-clicked"); 
    if (haircutNotClickedYet.length === 1) {
      haircutNotClickedYet.addClass("caracteristic-clicked");
    }
    // hair color :
    var hairColorNotClickedYet = $(".hairColor").not(".caracteristic-clicked"); 
    if (hairColorNotClickedYet.length === 1) {
      hairColorNotClickedYet.addClass("caracteristic-clicked");
    }
    // french native :
    var frenchNativeNotClickedYet = $(".frenchNative").not(".caracteristic-clicked"); 
    if (frenchNativeNotClickedYet.length === 1){
      frenchNativeNotClickedYet.addClass("caracteristic-clicked");
    }

    // main feature (suite)
    var firstClass = e.currentTarget.className.split(' ')[1];
    var secondClass = e.currentTarget.className.split(' ')[2];
    var people = $(".people");
    people.each(function(index){
      // console.log(guessWhoPeople[firstClass])
      if (guessWhoPeople[firstClass] === secondClass){
        if (!$(this).hasClass(secondClass)){
          $(this).css({"opacity" : "0"});
          $(this).addClass("hidden-people");
          $(this).addClass("blocked");
        } 
      } else {
        if ($(this).hasClass(secondClass)){
          $(this).css({"opacity" : "0"});
          $(this).addClass("hidden-people");
          $(this).addClass("blocked");
        }
      }
    })
    guessWho.isFinished()
  });

  // restart the game
  var restartgame = $(".btn-restart");
  restartgame.click(function (){
    window.location.reload();
    startgame.css({"display" : "none"});
  })

  // click directly on people to try to find the guessWhoPeople
  var peoplebutton = $(".people");
  peoplebutton.click(function (e){
    guessWho.updateChances()
    var pers = e.currentTarget;
    var winner = $('.popup-winer');
    if (pers.getAttribute("data-people-name") === guessWhoPeople.name){
      winner.css({"display" : "block"});
      $(".game").addClass("blocked");
    } else {
      $(pers).css({"opacity" : "0"});
      $(pers).addClass("hidden-people");
      $(pers).addClass("blocked");
    }
  })

  // enter in the game when we click on the start button at the begining of the game
  var startbtn = $(".btn-popup-welcome");
  startbtn.click(function (){
    var start = $('.popup-welcome');
    start.css({"display" : "none"});
    $(".game").removeClass("blocked");
  })

});

// class GuesWho
  class GuessWho {

    constructor(people){
    this.people = people;
    this.remainingChances = 5;
    }
  
   // shuffle randomnly the cards 
   shuffleCards() {
      var m = this.people.length, t, i;
  
      // While there remain elements to shuffle…
      while (m) {
  
        // Pick a remaining element…
        i = Math.floor(Math.random() * m--);
  
        // And swap it with the current element.
        t = this.people[m];
        this.people[m] = this.people[i];
        this.people[i] = t;
      }
    }

    updateChances() {
      var looser = $('.popup-looser');
      this.remainingChances --;
      $("#remaining-chances").html(this.remainingChances);
      if (this.remainingChances === 0){
        looser.css({"display" : "block"});
        $(".game").addClass("blocked");
      }
    }

    isFinished(){
      if ( $(".people").length - $(".hidden-people").length === 1){
        var winner = $('.popup-winer');
        winner.css({"display" : "block"});
        $(".game").addClass("blocked");
      } 
    } 

};