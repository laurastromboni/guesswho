var people = [
  { name: 'abi',
    img: 'Avatar_Abi.png',
    genre: 'genre-female',
    hairColor: 'hair-brown',
    haircut: 'haircut-middle',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Abi.png' },
  { name: 'adele',
    img: 'Avatar_Adele.png',
    genre: 'genre-female',
    hairColor: 'hair-ginger',
    haircut: 'haircut-long',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Adele.png' },
  { name: 'amine',
    img: 'Avatar_Amine.png',
    genre: 'genre-male',
    hairColor: 'hair-black',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-metis',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Amine.png' },
  { name: 'antoine',
    img: 'Avatar_Antoine.png',
    genre: 'genre-male',
    hairColor: 'hair-black',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-yes',
    skin: 'skin-white',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Antoine.png' },
  { name: 'cecile',
    img: 'Avatar_Cecile.png',
    genre: 'genre-female',
    hairColor: 'hair-brown',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Cecile.png' },
  { name: 'chloe',
    img: 'Avatar_Chloe.png',
    genre: 'genre-female',
    hairColor: 'hair-brown',
    haircut: 'haircut-middle',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Chloe.png' },
  { name: 'christian',
    img: 'Avatar_Christian.png',
    genre: 'genre-male',
    hairColor: 'hair-brown',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-black',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Christian.png' },
  { name: 'corrado',
    img: 'Avatar_Corrado.png',
    genre: 'genre-male',
    hairColor: 'hair-brown',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Corrado.png' },
  { name: 'fareaha',
    img: 'Avatar_Fareaha.png',
    genre: 'genre-female',
    hairColor: 'hair-black',
    haircut: 'haircut-middle',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-metis',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Fareaha.png' },
  { name: 'filippo',
    img: 'Avatar_Filippo.png',
    genre: 'genre-male',
    hairColor: 'hair-black',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-yes',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Filippo.png' },
  { name: 'geoffroy',
    img: 'Avatar_Geoffroy.png',
    genre: 'genre-male',
    hairColor: 'hair-brown',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-yes',
    skin: 'skin-metis',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Geoffroy.png' },
  { name: 'harnit',
    img: 'Avatar_Harnit.png',
    genre: 'genre-female',
    hairColor: 'hair-brown',
    haircut: 'haircut-long',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-metis',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Harnit.png' },
  { name: 'heather',
    img: 'Avatar_Heather.png',
    genre: 'genre-female',
    hairColor: 'hair-black',
    haircut: 'haircut-long',
    eyesColor: 'eyes-green',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Heather.png' },
  { name: 'helen',
    img: 'Avatar_Helen.png',
    genre: 'genre-female',
    hairColor: 'hair-brown',
    haircut: 'haircut-middle',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-black',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Helen.png' },
  { name: 'jean ni',
    img: 'Avatar_Jean-Ni.png',
    genre: 'genre-male',
    hairColor: 'hair-blond',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Jean-Ni.png' },
  { name: 'laura',
    img: 'Avatar_Laura.png',
    genre: 'genre-female',
    hairColor: 'hair-brown',
    haircut: 'haircut-long',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Laura.png' },
  { name: 'marie',
    img: 'Avatar_Marie.png',
    genre: 'genre-female',
    hairColor: 'hair-blond',
    haircut: 'haircut-middle',
    eyesColor: 'eyes-blue',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Marie.png' },
  { name: 'mathis',
    img: 'Avatar_Mathis.png',
    genre: 'genre-male',
    hairColor: 'hair-blond',
    haircut: 'haircut-short',
    eyesColor: 'eyes-green',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Mathis.png' },
  { name: 'mehdi',
    img: 'Avatar_Mehdi.png',
    genre: 'genre-male',
    hairColor: 'hair-black',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-yes',
    skin: 'skin-metis',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Mehdi.png' },
  { name: 'niccolo',
    img: 'Avatar_Niccolo.png',
    genre: 'genre-male',
    hairColor: 'hair-brown',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Niccolo.png' },
  { name: 'nicolas',
    img: 'Avatar_Nicolas.png',
    genre: 'genre-male',
    hairColor: 'hair-brown',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Nicolas.png' },
  { name: 'nizar',
    img: 'Avatar_Nizar.png',
    genre: 'genre-male',
    hairColor: 'hair-brown',
    haircut: 'haircut-short',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-yes',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Nizar.png' },
  { name: 'paul',
    img: 'Avatar_Paul.png',
    genre: 'genre-male',
    hairColor: 'hair-black',
    haircut: 'haircut-short',
    eyesColor: 'eyes-blue',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Paul.png' },
  { name: 'priyanka',
    img: 'Avatar_Priyanka.png',
    genre: 'genre-female',
    hairColor: 'hair-black',
    haircut: 'haircut-middle',
    eyesColor: 'eyes-brown',
    facialHair: 'facialhair-no',
    skin: 'skin-metis',
    glasses: 'glasses-yes',
    frenchNative: 'frenchnative-no',
    nudeImg : 'Avatar_Nude_Priyanka.png' },
  { name: 'regis',
    img: 'Avatar_Regis.png',
    genre: 'genre-male',
    hairColor: 'hair-brown',
    haircut: 'haircut-short',
    eyesColor: 'eyes-blue',
    facialHair: 'facialhair-no',
    skin: 'skin-white',
    glasses: 'glasses-no',
    frenchNative: 'frenchnative-yes',
    nudeImg : 'Avatar_Nude_Regis.png' }
];

$(document).ready(function(){
  var guessWho = new GuessWho(people);

  // use the shuffle function to shuffle randomnly the cards
  guessWho.shuffleCards();

  // lvl
  guessWho.chooseLevel();

  // show the popup welcome at the begining of the game, when we refresh the page
  var startgame = $('.popup-welcome');
  startgame.css({"display" : "block"});
  $(".game").addClass("blocked");
  $(".hidden-people-div").addClass("blocked");

  // hidden character popup
  $('.hidden-people-div').hover(function() {
    $('.popup-secret-character').toggle();
  })

  // Array of every people
  console.log(guessWho.people);
  // create the HTML divs for each people
  var html = '';
  guessWho.people.forEach(function (people) {
    html += '<div class="people ' + people.genre + ' ' + people.hairColor + ' '  + people.haircut + ' '  + people.eyesColor + ' '  + people.facialHair + ' '  + people.skin + ' '  + people.glasses + ' '  + people.frenchNative + ' " data-people-name="'+ people.name +'">';
    html += '  <div class="front-people" style="background: url(img/'+ people.img + '); background-size: contain;background-position: center;background-repeat: no-repeat"></div>';
    html += '  <div class="back-people"  style="background-color: #F8F5F5" name="'+ people.img +'"></div>';
    html += '</div>';
  });
  // Add all the div's to the HTML
  $('#avatars-board').html(html);

  // guess who people 
  var guessWhoPeople = people[Math.floor(Math.random()*people.length)];
  console.log(guessWhoPeople);

    // create the HTML img divs for each people
    var htmlTwo = $(
      '<div class="popup-img-new" style="background: url(img/'+ guessWhoPeople.nudeImg + '); background-size: contain;background-position: center;background-repeat: no-repeat"></div>'
    );
    // Add all the div's to the HTML
    $('.popnew h2').after(htmlTwo);

  // main feature : hide the wrong people after clicking on caracteristics buttons
  var buttons = $(".caracteristic");
  var guessWho = new GuessWho(people);
  var arrayAttributes = [];
  buttons.click(function (e){
    var currentbutton = $(event.target);
    var firstClass = e.currentTarget.className.split(' ')[1];
    var secondClass = e.currentTarget.className.split(' ')[2];
    guessWho.updateChances()
    
    var peopleKeys = Object.keys(guessWhoPeople);

    // add a new class to the characteristic (<img>) clicked
    currentbutton.addClass("caracteristic-clicked");

    var genreNotClickedYet = $(".genre").not(".caracteristic-clicked");

    // genre :
  // returns the genre which is not clicked yet
    if (genreNotClickedYet.length === 1 || secondClass === guessWhoPeople.genre){
      genreNotClickedYet.addClass("caracteristic-clicked");
    }
    //eyes color :
    var eyesColorNotClickedYet = $(".eyesColor").not(".caracteristic-clicked"); 
    if (eyesColorNotClickedYet.length === 1 || secondClass === guessWhoPeople.eyesColor) {
      eyesColorNotClickedYet.addClass("caracteristic-clicked");
    }
    //skin :
    var skinNotClickedYet = $(".skin").not(".caracteristic-clicked");
    if (skinNotClickedYet.length === 1 || secondClass === guessWhoPeople.skin) {
      skinNotClickedYet.addClass("caracteristic-clicked");
    }
    // glasses :
    var glassesNotClickedYet = $(".glasses").not(".caracteristic-clicked");
    if (glassesNotClickedYet.length === 1 || secondClass === guessWhoPeople.glasses){
      glassesNotClickedYet.addClass("caracteristic-clicked");
    }
    // facial hair :
    var facialHairNotClickedYet = $(".facialHair").not(".caracteristic-clicked");
    if (facialHairNotClickedYet.length === 1 || secondClass === guessWhoPeople.facialHair){
      facialHairNotClickedYet.addClass("caracteristic-clicked");
    }
    // hair cut :
    var haircutNotClickedYet = $(".haircut").not(".caracteristic-clicked"); 
    if (haircutNotClickedYet.length === 1 || secondClass === guessWhoPeople.haircut) {
      haircutNotClickedYet.addClass("caracteristic-clicked");
    }
    // hair color :
    var hairColorNotClickedYet = $(".hairColor").not(".caracteristic-clicked"); 
    if (hairColorNotClickedYet.length === 1 || secondClass === guessWhoPeople.hairColor) {
      hairColorNotClickedYet.addClass("caracteristic-clicked");
    }
    // french native :
    var frenchNativeNotClickedYet = $(".frenchNative").not(".caracteristic-clicked"); 
    if (frenchNativeNotClickedYet.length === 1 || secondClass === guessWhoPeople.frenchNative){
      frenchNativeNotClickedYet.addClass("caracteristic-clicked");
    }

    var isChecked = false;
    peopleKeys.forEach(function (key){

      if(secondClass === guessWhoPeople[key] && !isChecked){
       // create the HTML img divs for each people
       var htmlThree = $(
        '<h5>'+ currentbutton.attr('name') + '</h5>'
       );
        // Add all the div's to the HTML
        $('.popup-secret h2').after(htmlThree);
        isChecked = true;
        } else if (firstClass == "genre" && genreNotClickedYet.hasClass("caracteristic-clicked") && !isChecked){
          console.log(genreNotClickedYet)
          var htmlThree = $(
            '<h5>'+ prettyPhrases[guessWhoPeople.genre] + '</h5>'
          );
          $('.popup-secret h2').after(htmlThree);
          isChecked = true; }
         else if (firstClass == "skin" && skinNotClickedYet.hasClass("caracteristic-clicked") && !isChecked){
          console.log(skinNotClickedYet)
          var htmlThree = $(
            '<h5>'+ prettyPhrases[guessWhoPeople.skin] + '</h5>'
          );
          $('.popup-secret h2').after(htmlThree);
          isChecked = true;
        } else if (firstClass == "eyesColor" && eyesColorNotClickedYet.hasClass("caracteristic-clicked") && !isChecked){
          console.log(eyesColorNotClickedYet)
          var htmlThree = $(
            '<h5>'+ prettyPhrases[guessWhoPeople.eyesColor] + '</h5>'
          );
          $('.popup-secret h2').after(htmlThree);
          isChecked = true;
        } else if (firstClass == "glasses" && glassesNotClickedYet.hasClass("caracteristic-clicked") && !isChecked){
          console.log(glassesNotClickedYet)
          var htmlThree = $(
            '<h5>'+ prettyPhrases[guessWhoPeople.glasses] + '</h5>'
          );
          $('.popup-secret h2').after(htmlThree);
          isChecked = true;
        } else if (firstClass == "facialHair" && facialHairNotClickedYet.hasClass("caracteristic-clicked") && !isChecked){
          console.log(facialHairNotClickedYet)
          var htmlThree = $(
            '<h5>'+ prettyPhrases[guessWhoPeople.facialHair] + '</h5>'
          );
          $('.popup-secret h2').after(htmlThree);
          isChecked = true;
        } else if (firstClass == "haircut" && haircutNotClickedYet.hasClass("caracteristic-clicked") && !isChecked){
          console.log(haircutNotClickedYet)
          var htmlThree = $(
            '<h5>'+ prettyPhrases[guessWhoPeople.haircut] + '</h5>'
          );
          $('.popup-secret h2').after(htmlThree);
          isChecked = true;
        } else if (firstClass == "hairColor" && hairColorNotClickedYet.hasClass("caracteristic-clicked") && !isChecked){
          console.log(hairColorNotClickedYet)
          var htmlThree = $(
            '<h5>'+ prettyPhrases[guessWhoPeople.hairColor] + '</h5>'
          );
          $('.popup-secret h2').after(htmlThree);
          isChecked = true;
        } else if (firstClass == "frenchNative" && frenchNativeNotClickedYet.hasClass("caracteristic-clicked") && !isChecked){
          console.log(frenchNativeNotClickedYet)
          var htmlThree = $(
            '<h5>'+ prettyPhrases[guessWhoPeople.frenchNative] + '</h5>'
          );
          $('.popup-secret h2').after(htmlThree);
          isChecked = true;
        } 
    })
    console.log(arrayAttributes);

    // main feature (suite)
    var firstClass = e.currentTarget.className.split(' ')[1];
    var secondClass = e.currentTarget.className.split(' ')[2];
    var people = $(".people");
    people.each(function(index){
      // console.log(guessWhoPeople[firstClass])
      if (guessWhoPeople[firstClass] === secondClass){
        if (!$(this).hasClass(secondClass)){
          $(this).css({"opacity" : "0"});
          $(this).addClass("hidden-people");
          $(this).addClass("blocked");
        } 
      } else {
        if ($(this).hasClass(secondClass)){
          $(this).css({"opacity" : "0"});
          $(this).addClass("hidden-people");
          $(this).addClass("blocked");
        }
      }
    })
    guessWho.isFinished()
  });

var prettyPhrases = {
  "genre-female": "Gender : female",
  "genre-male": "Gender : male",
  "skin-white": "Skin color : white",
  "skin-metis": "Skin color : metis",
  "skin-black": "Skin color : black",
  "eyes-brown": "Eyes color : brown",
  "eyes-green": "Eyes color : green",
  "eyes-blue": "Eyes color : blue",
  "glasses-yes": "Glasses",
  "glasses-no": "No glasses",
  "facialhair-yes": "Facial hair",
  "facialhair-no": "No facial hair",
  "haircut-short": "Haircut : short hair",
  "haircut-medium": "Haircut : medium hair",
  "haircut-long": "Haircut : long hair",
  "hair-blond": "Hair color : blond hair",
  "hair-ginger": "Hair color : ginger hair",
  "hair-brown": "Hair color : brown hair",
  "hair-black": "Hair color : black hair",
  "frenchnative-yes": "French origin",
  "frenchnative-no": "No french origin",
};

  // restart the game
  var restartgame = $(".btn-restart");
  restartgame.click(function (){
    startgame.css({"display" : "none"});
    window.location.reload();
    startgame.css({"display" : "none"});
  })

// 'enter' instead of click on restart button
  var popupLooser = $(".popup-looser");
  var popupWinner = $(".popup-winer");
  $(document).keydown( function (event) {
    if (event.keyCode === 13) {
      if ( popupLooser.is(':visible') ){
        $(".btn-popup-looser").click();
      }
      else if ( popupWinner.is(':visible') ){
        $(".btn-popup-winer").click();
      }
    }
  })

  // click directly on people to try to find the guessWhoPeople
  var peoplebutton = $(".people");
  peoplebutton.click(function (e){
    guessWho.updateChances()
    var pers = e.currentTarget;
    var winner = $('.popup-winer');
    if (pers.getAttribute("data-people-name") === guessWhoPeople.name){
      winner.css({"display" : "block"});
      $(".game").addClass("blocked");
    } else {
      $(pers).css({"opacity" : "0"});
      $(pers).addClass("hidden-people");
      $(pers).addClass("blocked");
    }
  })

  // enter in the game when we click on the start button at the begining of the game
  var startbtn = $(".btn-popup-welcome");
  startbtn.click(function (){
    var start = $('.popup-welcome');
    start.css({"display" : "none"});
    $(".game").removeClass("blocked");
    $(".hidden-people-div").removeClass("blocked");
  })

});


var remainingChances;

// class GuesWho
  class GuessWho {

    constructor(people){
    this.people = people;
    }
  
   // shuffle randomnly the cards 
   shuffleCards() {
      var m = this.people.length, t, i;
  
      // While there remain elements to shuffle…
      while (m) {
  
        // Pick a remaining element…
        i = Math.floor(Math.random() * m--);
  
        // And swap it with the current element.
        t = this.people[m];
        this.people[m] = this.people[i];
        this.people[i] = t;
      }
    }

    updateChances() {
      var looser = $('.popup-looser');
      remainingChances --;
      $("#remaining-chances").html(remainingChances);
      if (remainingChances === 0){
        looser.css({"display" : "block"});
        $(".game").addClass("blocked");
      }
    }

    isFinished(){
      if ( $(".people").length - $(".hidden-people").length === 1){
        var winner = $('.popup-winer');
        winner.css({"display" : "block"});
        $(".game").addClass("blocked");
      } 
    } 

    chooseLevel(){
      $(".btn-easy-lvl").click(function(){
        console.log("hard lvl");
        remainingChances = 6;
        $("#remaining-chances").html(remainingChances);
      })
      $(".btn-medium-lvl").click(function(){
        console.log("hard lvl");
        remainingChances = 5;
        $("#remaining-chances").html(remainingChances);
      })
      $(".btn-hard-lvl").click(function(){
        console.log("hard lvl");
        remainingChances = 4;
        $("#remaining-chances").html(remainingChances);
      })
    }

};